package pregnantboy.tutorial.tasks;

import java.util.Queue;

import net.minecraft.block.state.IBlockState;
import net.minecraft.entity.monster.EntityMob;
import net.minecraft.init.Blocks;
import net.minecraft.util.BlockPos;
import net.minecraft.util.Vec3;
import net.minecraft.world.World;

public class BuildFarm {

	private EntityMob mob;
	private double x, y, z;
	private int length, width;
	private boolean hasBuildingInit, isBuildingDone;
	private Queue<BlockPos> blockPosQueue;
	private Queue<IBlockState> blocksQueue;
	private World world;
	private Vec3 buildingSpot;


	IBlockState farmBlock = Blocks.farmland.getDefaultState();
	IBlockState waterBlock = Blocks.water.getDefaultState();
	IBlockState acaciaFenceGateBlock = Blocks.acacia_fence_gate.getStateFromMeta(3);
	IBlockState acaciaFenceBlock = Blocks.acacia_fence.getDefaultState();
	IBlockState currBlock;
	
	public BuildFarm(EntityMob mob, int length, int width) {
		this.mob = mob;
		this.length = length;
		this.width = width;
		hasBuildingInit = false;
		isBuildingDone = false;
		world = mob.getEntityWorld();
	}

	public void init() {

		buildingSpot = mob.getPositionVector();
		x = mob.posX + 3;
		y = mob.posY;
		z = mob.posZ + 3;

		for (int w = 0; w < width; w++) {
			for (int l = 0; l < length; l++) {
				BlockPos pos = new BlockPos(x + w, y - 1, z + l);
				currBlock = farmBlock;
				
			}
		}
	}
	private void enqueue(BlockPos pos, IBlockState block) {
		blockPosQueue.add(pos);
		blocksQueue.add(block);
	}

	private void buildBlock(int buildSpeed) {
		if (blockPosQueue.size() < 1 || blocksQueue.size() < 1) {
			buildDoor();
			isBuildingDone = true;
		} else {
			for (int i = 0; i < buildSpeed; i ++) {
				world.setBlockState(blockPosQueue.remove(), blocksQueue.remove());
			}
		}
	}

	public boolean attemptBuildBlock(int buildSpeed) {
		if (isOnBuildingSpot()) {
			buildBlock(buildSpeed);
			mob.swingItem();
		} else {
			moveToBuildingSpot();
		}
		return isBuildingDone;
	}
	
	private boolean isOnBuildingSpot () {
		return (mob.getPositionVector().distanceTo(buildingSpot) < 1);
	}
	
	private void moveToBuildingSpot() {
		mob.getNavigator().tryMoveToXYZ(buildingSpot.xCoord, buildingSpot.yCoord, buildingSpot.zCoord, 1.0D);
	}
	
}
